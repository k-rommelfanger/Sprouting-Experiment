---
title: "SproutingPublicationCode"
output: html_document
date: "2025-09-22"
editor_options: 
  chunk_output_type: console
---

```{r Cleaning Data}
library(readr)
library(tidyverse)

#removed the two reps where intake radicle length was 10 in excel prior to import, this length is impossible 

sprout <- read_csv("Sprouting Experiment/data/E1 LARA_AVGE intake experiment Fall 2022 - MasterData.csv")

sprout<-sprout%>%filter(`IntakeDate`!="11/7/22")#remove the one random intake on 11/7 

##replace the <0.01 with 0.005 (essentially <RL is changed to half of the reporting limit)
sprout$`IntakeRadicleLength-cm`[sprout$`IntakeRadicleLength-cm`=="<0.1"]<-0.005

#change all NA to 0, in intake radical length
sprout$`IntakeRadicleLength-cm`[is.na(sprout$`IntakeRadicleLength-cm`)] <- 0


#split the tray number and treatment type into two separate columns so I can plot separately 
sprout<-sprout%>%separate(`Tray ID`, into = c("Treatment","Tray Number"), sep = " ")

#write an if else statement to make sprouted or not 0 or 1
#sprouted-1
#not sprouted-0
sprout$sprouted<-ifelse(sprout$SproutDate=="NA",'0','1')

#made not sprouted NA instead of 0, so changing NA to 0 in sprouted column
sprout$sprouted[is.na(sprout$sprouted)]<-0

sprout$SiteID<-gsub("STEER Basin", "STEER", sprout$SiteID)


#filter the props by species
LARA<-sprout%>%filter(Species=="LARA")
AVGE<-sprout%>%filter(Species=="AVGE")


#going to remove an outlier in AVGE (likely typo)
AVGE<-AVGE%>%
  filter(PropaguleLength!=0.40)
#dont think these are actually outliers, i think they were measured in cm, convert to mm
AVGE<-AVGE%>%
  mutate(`Width-mm`=if_else(`Width-mm`<7, `Width-mm`*10, `Width-mm`))
#more outliers (likely typos too)
#AVGE<-AVGE%>%
#  filter(`Width-mm`!=1.3)
#AVGE<-AVGE%>%
#  filter(`Width-mm`!=1.5)
#AVGE<-AVGE%>%
#  filter(`Width-mm`!=1.7)



# i think these were likely accidentally measured in cm, going to convert to mm
LARA<-LARA%>%
  mutate(`Width-mm`=if_else(`Width-mm`<4, `Width-mm`*10, `Width-mm`))
#LARA<-LARA%>%
 # filter(`Width-mm`>=4)

#changed my mind on this I don't think these are actually outliers leaving them in
#LARA<-LARA%>%
#  filter(`Width-mm`<=14)
#LARA<-LARA%>%
#  filter(Mass<=1.66)


#sprouted as numeric
AVGE$sprouted<-as.numeric(AVGE$sprouted)
LARA$sprouted<-as.numeric(LARA$sprouted)

#intake radicle length as numeric
AVGE$`IntakeRadicleLength-cm`<-as.numeric(AVGE$`IntakeRadicleLength-cm`)


#sproutdate and intake date as dates
sprout$SproutDate<-mdy(sprout$SproutDate)
sprout$IntakeDate<-mdy(sprout$IntakeDate)
```


Look at propagule bouyancy across collection sites, and across treatments

```{r Float/No Float}
#library(rcompanion)#posthoctest
library(ggpattern)
library(patchwork)


#bouyancy compared across treatments

#only six LARA props didn't float, so not enough sink to include as relevant, not visualizing
summary_countsLARA <- LARA %>%
  group_by(Treatment, Float) %>%
  summarise(count = n(), .groups = "drop")
#spread relatively evenly across treatments
  

#this is looking at the total number of props from each treatment that floated or not
summary_countsAVGE <- AVGE %>%
  group_by(Treatment, Float) %>%
  summarise(count = n(), .groups = "drop")
  
  
AVGEFbar1<-ggplot(data=summary_countsAVGE, aes(x=Treatment, y=count, fill=Float))+
  geom_col(position="dodge")

AVGEFbar1

#they are looking semi evenish, enough that floated and sank in each treatment

#Buoyancy compared across collection sites, info for table 2

#LARA across sites
siteLARA <- LARA %>%
  group_by( SiteID, Float) %>%
  summarise(count = n(), .groups = "drop")
#spread semi evenly across sites



#this is looking at the total number of AVGE props from each site that floated or not
siteAVGE <- AVGE %>%
  group_by( SiteID, Float) %>%
  summarise(count = n(), .groups = "drop")

  
  #Visualize float or sink by site
AVGEFbar1<-ggplot(data=siteAVGE, aes(x=SiteID, y=count, fill=Float))+
  geom_col(position="dodge")

AVGEFbar1

#count of number that floated vs sank
npropsAVGE<-c("n=87","n=31","n=82","n=38","n=30","n=89")

#making a nice version of this plot, how many floated/sank from each site (this plot Figure 3)
AVGEFbar1<-ggplot(data=siteAVGE, aes(x=SiteID, y=count, fill=Float))+
  geom_col(position="dodge")+
  ggtitle(expression(italic("A. germinans") ~ "Propagule Bouyancy Test"))+
   geom_text(aes(label = npropsAVGE),
            position = position_dodge(width = 0.9),
            vjust = -0.3,
            size = 3.0) +
  ylab("Propagule Count")+
  xlab("Collection Site")+
  scale_fill_manual(values = c("Y" = "lightblue", "N" = "darkblue"),
                    name = "Bouyancy", labels=c( "Did Not Float", "Floated"))+
  theme(plot.title = element_text(hjust = 0.5), panel.background = element_rect(fill = "white", colour = "grey50"))
  

AVGEFbar1

#going to plot LARA

siteLARA<-siteLARA%>%
  filter(Float!="NA")

npropsLARA<-c("n=1","n=119","n=1","n=119","n=4", "n=113")

siteLARA$nprops <- npropsLARA

LARAbar1<-ggplot(data=siteLARA, aes(x=SiteID, y=count, fill=Float))+
  geom_col(position="dodge")+
  ggtitle(expression(italic("L. racemosa") ~ "Propagule Bouyancy Test"))+
   geom_text(aes(label = nprops),
            position = position_dodge(width = 0.9),
            vjust = -0.3,
            size = 3.0) +
  ylab("Propagule Count")+
  xlab("Collection Site")+
  scale_fill_manual(values = c("Y" = "lightblue", "N" = "darkblue"),
                    name = "Bouyancy", labels=c( "Did Not Float", "Floated"))+
  theme(plot.title = element_text(hjust = 0.5), panel.background = element_rect(fill = "white", colour = "grey50"))

LARAbar1

#combine plots

Float<-LARAbar1+AVGEFbar1+  plot_layout(guides = "collect")
Float



#more sink from compass and steer, more float from vessup salt pond going to test statistical difference with chi squared test

#good chi square test reference

#https://lukaswallrich.github.io/GoldCoreQuants/chi-squared-tests-for-associations-between-categorical-variables.html 

chiframe<-siteAVGE%>%
  pivot_wider(names_from = Float, values_from = count)

chitest<-chisq.test(chiframe[,-1])
chitest

#	Pearson's Chi-squared test

#data:  chiframe[, -1]
#X-squared = 68.152, df = 2, p-value = 1.589e-15


chitest$expected
#making sure that the expected values arent too low, if sample size is low, then you need to either correct the chi squred value or simulate more replicates, but we are good here

chitest$residuals

#              N         Y
#[1,]  2.616951 -2.936930
#[2,]  1.847395 -2.073279
#[3,] -4.461073  5.006536


```


Calculating mean and sem of intake characteristics (MEAN/SEM Intake Variables Table X)

```{r Mean and St Dev}

library(plotrix)#for SEM

#this is calculating mean Mass, Length, width and radicle lenght for AVGE
AVGEsum<-AVGE%>%
  group_by(SiteID)%>%
  summarise(meanmass=mean(Mass), meanlenght=mean(PropaguleLength), meanWidth=mean(`Width-mm`), meanRad=mean(`IntakeRadicleLength-cm`))
 

#this calculates standard error for each of the above metrics
AVGEsem<-AVGE%>%
  group_by(SiteID)%>%
  summarise(SEMmass=std.error(Mass), SEMlenght=std.error(PropaguleLength), SEMWidth=std.error(`Width-mm`),SEMrad=std.error(`IntakeRadicleLength-cm`))


#calculating means for LARA
LARAsum<-LARA%>%
  group_by(SiteID)%>%
  summarise(meanmass=mean(Mass), meanlenght=mean(PropaguleLength), meanWidth=mean(`Width-mm`))

#LARA SEM
LARAsem<-LARA%>%
  group_by(SiteID)%>%
  summarise(SEMmass=std.error(Mass), SEMlenght=std.error(PropaguleLength), SEMWidth=std.error(`Width-mm`))

```


Lara Intake: Check for significant differences in mass, length, and width, across sites using a Kruskall Wallis Test

```{r Compare LARA intake Variables Across Sites}
library(FSA)#for DunnPost Hoc
library(rcompanion)#for cldList function
library(agricolae)#Tukey post hoc test

#check for significant differences in LARA Mass between sites

#check assumptions and try transformations
bartlett.test(Mass~SiteID, LARA) #nope

#no good, try transform

LARA$MassSQ<-(LARA$Mass)^2
bartlett.test(MassSQ~SiteID,LARA)#nope
LARA$MassSR<-sqrt(LARA$Mass)
bartlett.test(MassSR~SiteID, LARA)#nope
LARA$logMass<-(log(LARA$Mass))
bartlett.test(logMass~SiteID, LARA)#nope

#check residuals

LMaov<-aov(Mass~SiteID, LARA)
#pull Resids
aov_residuals <- residuals(LMaov)
hist(aov_residuals)#skewed
shapiro.test(aov_residuals)#<-1.645e-11
#nope

#nonparametric
LARAMkw<-kruskal.test(Mass~SiteID, data=LARA)
LARAMkw

#	Kruskal-Wallis rank sum test

#data:  Mass by SiteID
#Kruskal-Wallis chi-squared = 101.11, df = 2, p-value < 2.2e-16

#post hoc 

LARAMkw

#now we run post hoc analysis
LARAMDunn=dunnTest(Mass ~ SiteID,
  data = LARA)

LARAMDunn

Lab1 = LARAMDunn$res

cldList(comparison = Lab1$Comparison,
        p.value    = Lab1$P.adj,
        threshold  = 0.05)

#           Group Letter MonoLetter
#1   CompassPoint      a         a 
#2     STEERBasin      b          b
#3 VessupSaltPond      c          c




#compare length differences across sites


#check assumptions and try transformations
bartlett.test(PropaguleLength~SiteID, LARA) #nope
#no good, try transform

LARA$PropLentghtSQ<-(LARA$PropaguleLength)^2
bartlett.test(PropLentghtSQ~SiteID,LARA)# nope
LARA$PropaguleLengthSR<-sqrt(LARA$PropaguleLength)
bartlett.test(PropaguleLengthSR~SiteID,LARA)#nope

#check residuals

LLaov<-aov(PropaguleLength~SiteID, LARA)
#pull Resids
aov_residuals <- residuals(LLaov)
hist(aov_residuals)#skewed
shapiro.test(aov_residuals)#<- 0.0002137
#nope

#nonparametric
LARALkw<-kruskal.test(PropaguleLength~SiteID, data=LARA)
LARALkw

#	Kruskal-Wallis rank sum test

#data:  PropaguleLength by SiteID
#Kruskal-Wallis chi-squared = 106.92, df = 2, p-value < 2.2e-16


#post hoc test
LARALDunn=dunnTest(PropaguleLength ~ SiteID,
  data = LARA)

LARALDunn

#letters
Lab1 = LARALDunn$res

cldList(comparison = Lab1$Comparison,
        p.value    = Lab1$P.adj,
        threshold  = 0.05)

#           Group Letter MonoLetter
#1   CompassPoint      a        a  
#2     STEERBasin      b         b 
#3 VessupSaltPond      c          c



#Width is next!

#check assumptions and try transformations
bartlett.test(`Width-mm`~SiteID, LARA) #yes!

#no good, try transform
LARA$WSQ<-(LARA$`Width-mm`)^2
bartlett.test(WSQ~SiteID,LARA)#nope
LARA$WSR<-sqrt(LARA$Mass)
bartlett.test(WSR~SiteID, LARA)#nope

#check residuals

LWaov<-aov(`Width-mm`~SiteID, LARA)
#pull Resids
aov_residuals <- residuals(LWaov)
hist(aov_residuals)#skewed
shapiro.test(aov_residuals)#<- 2.919e-08
#nope

#nonparametric
LARAWkw<-kruskal.test(`Width-mm`~SiteID, data=LARA)
LARAWkw

#	Kruskal-Wallis rank sum test

#data:  Width-mm by SiteID
#Kruskal-Wallis chi-squared =  27.246, df = 2, p-value = 1.212e-06


LARAWDunn=dunnTest(`Width-mm` ~ SiteID,
  data = LARA)

LARAWDunn

Lab1 = LARAWDunn$res

cldList(comparison = Lab1$Comparison,
        p.value    = Lab1$P.adj,
        threshold  = 0.05)

#           Group Letter MonoLetter
#1   CompassPoint      a         a 
#2     STEERBasin      b          b
#3 VessupSaltPond      b          b

```


A germinans intake across sites Kruskall Wallis Test 

```{r Compare AVGE intake Variables Across Sites}

#check for significant differences in AVGE Mass between sites

#check assumptions and try transformations
bartlett.test(Mass~SiteID, AVGE) #p= 1.519e-05

#no good, try transform

AVGE$MassSQ<-(AVGE$Mass)^2
bartlett.test(MassSQ~SiteID,AVGE)#nope
AVGE$MassSR<-sqrt(AVGE$Mass)
bartlett.test(MassSR~SiteID, AVGE)#= 0.005135
#no good 


#check residuals

AMaov<-aov(Mass~SiteID, AVGE)
#pull Resids
aov_residuals <- residuals(AMaov)
hist(aov_residuals)#skewed
shapiro.test(aov_residuals)#<-0.0005958


#nonparametric
AVGEMkw<-kruskal.test(Mass~SiteID, data=AVGE)
AVGEMkw

#			Kruskal-Wallis rank sum test

#data:  Mass by SiteID
#Kruskal-Wallis chi-squared = 23.163, df = 2, p-value = 9.335e-06

#post hoc 

#now we run post hoc analysis
AVGEMDunn=dunnTest(Mass ~ SiteID,
  data = AVGE)

AVGEMDunn

#interpret the results of Dunn and turn into letters of significant difference
Lab1 = AVGEMDunn$res

cldList(comparison = Lab1$Comparison,
        p.value    = Lab1$P.adj,
        threshold  = 0.05)

#               Group Letter MonoLetter
#1   CompassPoint      a         a 
#2     STEERBasin      b          b
#3 VessupSaltPond      a         a 




#compare length differences across sites

#check assumptions and try transformations
bartlett.test(PropaguleLength~SiteID, AVGE) #p=0.006868
#transform

AVGE$PropLentghtSQ<-(AVGE$PropaguleLength)^2
bartlett.test(PropLentghtSQ~SiteID,AVGE)# 0.0007166
#NOPE
AVGE$PropLengthSR<-(sqrt(AVGE$PropaguleLength))
bartlett.test(PropLengthSR~SiteID,AVGE)# 0.01596
#nope, nonparametric

#check Residuals

ALaov<-aov(PropaguleLength~SiteID, AVGE)
#pull Resids
aov_residuals <- residuals(ALaov)
hist(aov_residuals)#skewed
shapiro.test(aov_residuals)#<-0.04013

#nonparametric
AVGELkw<-kruskal.test(PropaguleLength~SiteID, data=AVGE)
AVGELkw

#	Kruskal-Wallis rank sum test

#data:  PropaguleLength by SiteID
#Kruskal-Wallis chi-squared = 9.3863, df = 2, p-value = 0.009158

#post hoc
AVGELDunn=dunnTest(PropaguleLength ~ SiteID,
  data = AVGE)

AVGELDunn

Lab1 = AVGELDunn$res

cldList(comparison = Lab1$Comparison,
        p.value    = Lab1$P.adj,
        threshold  = 0.05)

#           Group Letter MonoLetter
#1   CompassPoint      a         a 
#2     STEERBasin      b          b
#3 VessupSaltPond     a        a

#Width is next!

#check assumptions and try transformations
bartlett.test(`Width-mm`~SiteID, AVGE) #p=0.09896

#check residuals
WAOV<-aov(`Width-mm`~SiteID, AVGE)
plot(WAOV)

hist(WAOV$residuals)
shapiro.test(WAOV$residuals)#0.009788
#nonparametric

AVGEWKW<-kruskal.test(`Width-mm`~SiteID, AVGE)
AVGEWKW

#Kruskal-Wallis rank sum test

#data:  Width-mm by SiteID
#Kruskal-Wallis chi-squared = 19.69, df = 2, p-value = 5.302e-05

#post hoc
AVGEWDunn=dunnTest(`Width-mm` ~ SiteID,
  data = AVGE)

AVGEWDunn

Lab1 = AVGEWDunn$res

cldList(comparison = Lab1$Comparison,
        p.value    = Lab1$P.adj,
        threshold  = 0.05)

#           Group Letter MonoLetter
#1   CompassPoint      a         a 
#2     STEERBasin      b          b
#3 VessupSaltPond      a         a 

#now look at radical length at intake

AVGE$`IntakeRadicleLength-cm`<-as.numeric(AVGE$`IntakeRadicleLength-cm`)

#check assumptions and try transformations
bartlett.test(`IntakeRadicleLength-cm`~SiteID, AVGE) #p=0.2843
#run ANOVA
ARLaov<-aov(`IntakeRadicleLength-cm`~SiteID, AVGE)
#pull Resids
aov_residuals <- residuals(ARLaov)
hist(aov_residuals)#skewed
shapiro.test(aov_residuals)#< 2.2e-16
#transform

AVGE$RadLSQ<-(AVGE$`IntakeRadicleLength-cm`)^2
bartlett.test(RadLSQ~SiteID,AVGE)#0.007824
#NOPE
AVGE$RadlSR<-(sqrt(AVGE$`IntakeRadicleLength-cm`))
bartlett.test(RadlSR~SiteID,AVGE)#0.9842

RadLSRaov<-aov(RadlSR~SiteID, AVGE)
aov_residuals <- residuals(RadLSRaov)
hist(aov_residuals)
shapiro.test(aov_residuals)#nope, nonparametric

AVGERadLkw<-kruskal.test(`IntakeRadicleLength-cm`~SiteID, data=AVGE)
AVGERadLkw

#	Kruskal-Wallis rank sum test

#data:  IntakeRadicleLength-cm by SiteID
#Kruskal-Wallis chi-squared = 25.405, df = 2, p-value = 3.043e-06

#post hoc 


AVGERadLDunn=dunnTest(`IntakeRadicleLength-cm` ~ SiteID,
  data = AVGE)

AVGERadLDunn


Lab1 = AVGERadLDunn$res

cldList(comparison = Lab1$Comparison,
        p.value    = Lab1$P.adj,
        threshold  = 0.05)

#           Group Letter MonoLetter
#1   CompassPoint      a         a 
#2     STEERBasin      a         a 
#3 VessupSaltPond      b          b

```


Visualize size differences by species and collection site

Visualizing propagule characteristics determining differences between sites, showing outputs of kw tests Figure4/5

```{r Site Visualizations Sinaplots}
library(tidyverse)
library(patchwork)
library(ggforce)#for sinaplots


#making some violin plots, including a sina plot inside better representations of the distribution of the data

#link talking about what sinaplots are and why to use them
#https://datavizpyr.com/sinaplot-vs-violin-plot-why-sinaplot-is-better-than-violinplot/

#first, get a version of the plot that you like, making example plot LARA mass

#making these title objects so I can italisize the sp name in the titles
title1<-expression(italic("L. racemosa")~"Seed Mass")

testplot<-LARA%>%
  ggplot(aes(x=SiteID, y=Mass, color=SiteID))+#setting my x and y values, 
  geom_violin()+#makes the plot that follows shape of the data
    geom_sina(alpha=0.5)+#adds all the dots to the violin plot needs ggforce library
    geom_boxplot(width=0.1, color="black", alpha=0.5)+
  ggtitle(title1)+
  ylab("Mass (g)")+
  xlab("Collection Site")+
  theme(legend.position="none", plot.title = element_text(hjust = 0.5), panel.background = element_rect(fill = "white", colour = "grey50"))+#no legend, centered title, no background
    scale_color_manual(name = "Site", values = c("darkgreen","salmon4", "olivedrab"))#sets the colors manually of the dots, and outlines of violin plots

#testplot doesnt include the lettering added in function
  

testplot

#then you can turn the plot into a function to make all of the plots for each combo of species and lenght, width, mass without copying and pasting the code a million times. Also if a change needs to be made to teh plot you can just modify the function and rerun the code




#SPECIES:This is the cleaned dataframe I have filtered the dataframes so there is only one species in each dataframe
#YVal: response variable
#title: "put title you want in quotes"
#ylab: "put ylab you want in quotes"
#CP: letter above compass point from KW/Dunn post hoc
#SB: Letter above salt river from KW/Dunn post hoc
#VSP: letter above VSPfrom KW/Dunn post hoc
#Yplace: number of units above the max y value you want to put your letters

PropViolinPlot<-function(SPECIES,YVal, title, ylab, CP, SB, VSP,Yplace){SPECIES%>%
  ggplot(aes(x=SiteID, y=YVal, color=SiteID))+#setting my x and y values, 
  geom_violin()+#makes the plot that follows shape of the data
    geom_sina(alpha=0.3)+#adds all the dots to the violin plot needs ggforce library
    geom_boxplot(width=0.1, color="black", alpha=0.5)+
  ggtitle(title)+
  ylab(ylab)+
  xlab("Collection Site")+
  theme(legend.position="none", plot.title = element_text(hjust = 0.5), panel.background = element_rect(fill = "white", colour = "grey50"))+#no legend, centered title, no background
    scale_color_manual(name = "Site", values = c("darkgreen","salmon4", "olivedrab"))+#sets the colors manually of the dots, and outlines of violin plots
  geom_text(aes(family="serif", fontface="plain"),size=6,x= "Compass Point" , y=Yplace, label=CP, colour="black")+#add first letter, family and fontface change font and remove bold
  geom_text(aes(family="serif", fontface="plain"),size=6,x= "STEER" , y=Yplace, label=SB, colour="black")+#add second letter
  geom_text(aes(family="serif", fontface="plain"),size=6, x= "Vessup Salt Pond" , y=Yplace, label=VSP, colour="black")}#third letter 


#replotting everything with violin plots stacked with boxplots

#making these title objects so I can italisize the sp name in the titles
title1<-expression(italic("L. racemosa")~"Seed Mass")
title2<-expression(italic("A. germinans")~"Propagule Mass")
title3<-expression(italic("L. racemosa")~"Seed Length")
title4<-expression(italic("A. germinans")~"Propagule Length")
title5<-expression(italic("L. racemosa")~"Seed Width")
title6<-expression(italic("A. germinans")~"Propagule Width")
title7<-expression(italic("A. germinans")~"Radicle Length")


#plot LARA mass
VLARAmass<-PropViolinPlot(LARA, LARA$Mass, title1, "Mass (g)", "a","b","c", 2)

#set the y limits
VLARAmass<-VLARAmass+ylim(0,2)

VLARAmass

#plot AVGE mass
VAVGEmass<-PropViolinPlot(AVGE, AVGE$Mass, title2, "Mass (g)", "a", "b","a", 3.7)
VAVGEmass<-VAVGEmass+ylim(0,4)
VAVGEmass

#plot LARA length
VLARAlength<-PropViolinPlot(LARA, LARA$PropaguleLength, title3, "Length (cm)", "a", "b","c", 3.5)

VLARAlength<-VLARAlength+ylim(1,3.5)
VLARAlength

#plot AVGE length
VAVGElength<-PropViolinPlot(AVGE, AVGE$PropaguleLength, title4, "Length (cm)", "a", "b","a", 3.3)

VAVGElength<-VAVGElength+ylim(0,3.3)
VAVGElength

#LARA Width
VLARAwidth<-PropViolinPlot(LARA, LARA$`Width-mm`, title5, "Width (mm)", "a", "b","b", 22)

VLARAwidth<-VLARAwidth+ylim(0,22)
VLARAwidth

#AVGE width
VAVGEwidth<-PropViolinPlot(AVGE, AVGE$`Width-mm`, title6, "Width (mm)", "a", "b","a", 25)

VAVGEwidth<-VAVGEwidth+ylim(0,25)
VAVGEwidth

#AVGE rad length
AVGE$`IntakeRadicleLength-cm`<-as.numeric(AVGE$`IntakeRadicleLength-cm`)
VAVGEradlength<-PropViolinPlot(AVGE, AVGE$`IntakeRadicleLength-cm`, title7, " Radicle Length (cm)", "a", "a","b", 1.65)

VAVGEradlength<-VAVGEradlength+ylim(0,1.65)
VAVGEradlength

#combining plots with patchwork

CharPlot<-(VLARAlength|VAVGElength)/(VLARAwidth|VAVGEwidth)/(VLARAmass|VAVGEmass)/ (plot_spacer()|VAVGEradlength)

CharPlot

#exporing plot with ggsave, ensures it is always the same size, outputs into project file
ggsave(
  filename = "IntakeCharPlot1.jpg",  # output file name
  plot = CharPlot,            # your ggplot object
  width = 3000,                      # width in pixels
  height = 3200,                     # height in pixels
  units = "px",                      # set units to pixels
  dpi = 300                          # resolution
)

```


Look at sprout or not sprout as a binary, 0/1 then plot and run logistic regression to see the effect of the prop characteristics on whether or not things sprouted AVGE, ran multiple logistic regressions, compared with AIC (Table 4) Plotting and checking correlation

```{r Logits AVGE Only}
library(car)#for calculating VIF, test how correlation looks
library(DHARMa)#for simulate residuals, to check assumptions
library(patchwork)

#exploring plotting the data
#Length
ggplot(data = AVGE, aes(x = PropaguleLength, y = sprouted, color=Treatment)) +
  geom_point(alpha = 0.1) +
  geom_smooth(method = "glm", method.args = list(family ="binomial"))
#mass
ggplot(data = AVGE, aes(x = Mass, y = sprouted, color=Treatment)) +
  geom_point(alpha = 0.1) +
  geom_smooth(method = "glm", method.args = list(family ="binomial"))
#width
ggplot(data = AVGE, aes(x = `Width-mm`, y = sprouted, color=Treatment)) +
  geom_point(alpha = 0.1) +
  geom_smooth(method = "glm", method.args = list(family ="binomial"))

#intake rad length
ggplot(data = AVGE, aes(x = `IntakeRadicleLength-cm`, y = sprouted, color=Treatment)) +
  geom_point(alpha = 0.1) +
  geom_smooth(method = "glm", method.args = list(family ="binomial"))


#multiply l*w then see, to get propagule area 
AVGE<-AVGE%>%mutate(Area=(PropaguleLength*`Width-mm`))

#create density column
AVGE<-AVGE%>%mutate(Density=(PropaguleLength*`Width-mm`)/Mass)



#area
ggplot(data = AVGE, aes(x = Area, y = sprouted, color=Treatment)) +
  geom_point(alpha = 0.1) +
  geom_smooth(method = "glm", method.args = list(family ="binomial"))

#density
ggplot(data = AVGE, aes(x = Density, y = sprouted, color=Treatment)) +
  geom_point(alpha = 0.1) +
  geom_smooth(method = "glm", method.args = list(family ="binomial"))

#not equally represented across groups



#check for correlation in my propagule characteristic variables
cor_matrix <- cor(AVGE[, c("PropaguleLength", "Width-mm", "Mass","IntakeRadicleLength-cm")], use = "complete.obs")

print(cor_matrix)

 #                        PropaguleLength   Width-mm        Mass IntakeRadicleLength-cm
#PropaguleLength           1.0000000000  0.8457139  0.86660365          -0.0007471787
#Width-mm                  0.8457139361  1.0000000  0.87492965          -0.1293148146
#Mass                      0.8666036494  0.8749297  1.00000000          -0.0916776096
#IntakeRadicleLength-cm   -0.0007471787 -0.1293148 -0.09167761           1.0000000000

#L,w,m  have a strong correlation should not include all in the model, above 0.7 is highly correlated

#good source explaining 
#https://statisticsbyjim.com/regression/multicollinearity-in-regression-analysis/


```




Rerunning all combonations of AVGE logistic regressions
```{r}
#treatment only
Basic1<-glm(sprouted~Treatment, data=AVGE, family="binomial")
summary(Basic1)
#189.63

#treatment&siteID
Basic<-glm(sprouted~Treatment+SiteID, data=AVGE, family="binomial")
summary(Basic)
#191.5

#Treatment/Site/Length
TSL<-glm(sprouted~Treatment+SiteID+PropaguleLength, data=AVGE, family="binomial")
summary(TSL)
#191.71

#Treatment/Site/Width
TSW<-glm(sprouted~Treatment+SiteID+`Width-mm`, data=AVGE, family="binomial")
summary(TSW)
#193.22

#Treatment/Site/Mass
TSM<-glm(sprouted~Treatment+SiteID+Mass, data=AVGE, family="binomial")
summary(TSM)
#193.49

#Treatment&Float
Basic3<-glm(sprouted~Treatment+Float, data=AVGE, family="binomial")
summary(Basic3)
#189.23

#lenght
BasicL<-glm(sprouted~Treatment+PropaguleLength, data=AVGE, family="binomial")
summary(BasicL)
#190.39

#width
BasicW<-glm(sprouted~Treatment+`Width-mm`, data=AVGE, family="binomial")
summary(BasicW)
#190.98

#mass
BasicM<-glm(sprouted~Treatment+Mass, data=AVGE, family="binomial")
summary(BasicM)
#191.62


#float length
#exclude site not significant (Best Model!)
NoSLengthLogit<-glm(sprouted~Float+Treatment+PropaguleLength, data=AVGE, family="binomial")
summary(NoSLengthLogit)


#Call:
#glm(formula = sprouted ~ Float + Treatment + PropaguleLength, 
#    family = "binomial", data = AVGE)

#Coefficients:
#                Estimate Std. Error z value Pr(>|z|)    
#(Intercept)      -0.1487     1.2331  -0.121    0.904    
#FloatY            0.8115     0.4380   1.852    0.064 .  
#TreatmentFresh    6.3498     1.0617   5.981 2.22e-09 ***
#TreatmentSalt     5.8099     0.8119   7.156 8.31e-13 ***
#TreatmentSoil     3.5559     0.4419   8.046 8.53e-16 ***
#PropaguleLength  -0.8830     0.5679  -1.555    0.120    
#---
#Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1

#(Dispersion parameter for binomial family taken to be 1)

#    Null deviance: 405.31  on 356  degrees of freedom
#Residual deviance: 176.76  on 351  degrees of freedom
#AIC: 188.76

#Number of Fisher Scoring iterations: 7

#exponentiating the coefficients of the best fit model so i can understand their effect more directly
exp(coef(NoSLengthLogit))

#   (Intercept)          FloatY  TreatmentFresh   TreatmentSalt   TreatmentSoil PropaguleLength 
#      0.8617965       2.2511855     572.3962404     333.5957369      35.0179225       0.4135561

#testing assumptions of bestfit model
qqnorm(residuals(NoSLengthLogit, type = "pearson"))


#float, width
NoSWidthLogit<-glm(sprouted~Float+Treatment+`Width-mm`, data=AVGE, family="binomial")
summary(NoSWidthLogit)
#191.01

#flaotmass
NoSMassLogit<-glm(sprouted~Float+Treatment+Mass, data=AVGE, family="binomial")
summary(NoSMassLogit)
#191.21

#site/float
BasicLogit<-glm(sprouted~SiteID+Float+Treatment, data=AVGE, family="binomial")
summary(BasicLogit)
#191.5

#site/float/length

LengthLogit<-glm(sprouted~SiteID+Float+Treatment+PropaguleLength, data=AVGE, family="binomial")
summary(LengthLogit)
#190.33

#site/Float/width
WidthLogit<-glm(sprouted~SiteID+Float+Treatment+`Width-mm`, data=AVGE, family="binomial")
summary(WidthLogit)
#193.47

#site/Float/Mass
masslogit<-glm(sprouted~SiteID+Float+Treatment+Mass, data=AVGE, family="binomial")
summary(masslogit)
#193.34
```


Making a figure predicting sprouting using the best model generated for AVGE
```{r AVGE logit Figure}
#here I am creating a new dataframe to hold the predicted values, I am keeping length constant at the mean length value, so predicted values only reflect treatment and buoyancy, expand.grid creates all combos of supplied vectors (my float and treatment vectors) keeping propagule length constant at the mean
AVGEpredict<- expand.grid(
  Float = c("Y", "N"), #two bouyancy options
  Treatment = c("Fresh", "Salt", "Soil", "Air"), #four treatment options
  PropaguleLength = mean(AVGE$PropaguleLength))  # hold length constant


# we are generating data for each treatment using the model created from our experimental data here, predict(mylogitmodel, newdf, type=return linear predictor log odds, not translate to probablitiles, also give SE)
AVGEpredict1 <- predict(NoSLengthLogit, AVGEpredict, type = "link", se.fit = TRUE)

#now i have the log odds for each treatment bouyancy combo and standard errors, need to convert to probabilites

# Convert from log-odds to probability ð‘¥x to probability ð‘=1/(1+ð‘’âˆ’ð‘¥)p=1/(1+eâˆ’x) for probabilites and confidence intervals (combines estimate, uncertianty (SE), and confidence level)
AVGEpredict$prob <- plogis(AVGEpredict1$fit)  # predicted probability
AVGEpredict$lower <- plogis(AVGEpredict1$fit - 1.96 * AVGEpredict1$se.fit)  # lower 95% CI
AVGEpredict$upper <- plogis(AVGEpredict1$fit + 1.96 * AVGEpredict1$se.fit)  # upper 95% CI


#plot predicted
AVGElogitplot<-ggplot(AVGEpredict, aes(x = Treatment, y = prob, color = Float)) +
  geom_point(position = position_dodge(width = 0.5), size = 3) +
  geom_errorbar(aes(ymin = lower, ymax = upper), width = 0.2,
                position = position_dodge(width = 0.5)) +
  ylim(0,1) +
  labs(y = "Predicted sprouting probability",
       x = "Treatment",
       color = "Float")+
  ggtitle(expression(italic("A. germinans")~"Predicted Sprouting Probability"))+
   scale_color_manual(values = c("Y" = "lightblue", "N" = "darkblue"),
                    name = "Bouyancy", labels=c( "Did Not Float", "Floated"))+
  theme(plot.title = element_text(hjust = 0.5),panel.background = element_rect(fill = "white", colour = "grey50"))

AVGElogitplot

```


rerunning all combinations of LARA logistic regression, not including bouyancy for this one because not enough representation of sinking

```{r LARA logit}
#treatment only
Basic1<-glm(sprouted~Treatment, data=LARA, family="binomial")
summary(Basic1)
#297.15

#treatment&siteID
Basic<-glm(sprouted~Treatment+SiteID, data=LARA, family="binomial")
summary(Basic)
#300.39

#Treatment/Site/Length
TSL<-glm(sprouted~Treatment+SiteID+PropaguleLength, data=LARA, family="binomial")
summary(TSL)
#297.62

#Treatment/Site/Width
TSW<-glm(sprouted~Treatment+SiteID+`Width-mm`, data=LARA, family="binomial")
summary(TSW)
#298.65

#Treatment/Site/Mass
TSM<-glm(sprouted~Treatment+SiteID+Mass, data=LARA, family="binomial")
summary(TSM)
#293.85

#Treatment&Float
Basic3<-glm(sprouted~Treatment+Float, data=LARA, family="binomial")
summary(Basic3)
#290.29

#lenght
BasicL<-glm(sprouted~Treatment+PropaguleLength, data=LARA, family="binomial")
summary(BasicL)
#296.49

#width
BasicW<-glm(sprouted~Treatment+`Width-mm`, data=LARA, family="binomial")
summary(BasicW)
# 295.83

#mass
BasicM<-glm(sprouted~Treatment+Mass, data=LARA, family="binomial")
summary(BasicM)

#Call:
#glm(formula = sprouted ~ Treatment + Mass, family = "binomial", 
#    data = LARA)

#Coefficients:
#               Estimate Std. Error z value Pr(>|z|)    
#(Intercept)     -2.1058     0.6003  -3.508 0.000452 ***
#TreatmentFresh   3.7935     0.5222   7.264 3.75e-13 ***
#TreatmentSalt    3.6962     0.5189   7.122 1.06e-12 ***
#TreatmentSoil    2.0476     0.3494   5.860 4.64e-09 ***
#Mass             2.1533     0.9602   2.243 0.024924 *  
#---
#Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1

#(Dispersion parameter for binomial family taken to be 1)

#    Null deviance: 418.92  on 358  degrees of freedom
#Residual deviance: 283.63  on 354  degrees of freedom
#AIC: 293.63

#Number of Fisher Scoring iterations: 5


```


Now plotting the best model using predict

```{r}
library(patchwork)
#making treatment a factor
LARA$Treatment<-as.factor(LARA$Treatment)

# Mass sequence (generating 100 evenly spaced mass points across observed range from data)
mass_seq <- seq(
  from = min(LARA$Mass),
  to   = max(LARA$Mass),
  length.out = 100
)

# Makes it so each mass value has a corresponding place for each of the four levels of treatment in my LARA df
LARApredict <- expand.grid(
  Mass = mass_seq,
  Treatment = levels(LARA$Treatment)
)

#treatment is a factor, same as when model was fitted
LARApredict$Treatment <- factor(LARApredict$Treatment, levels = levels(LARA$Treatment))


# Predict values using my model, on link scale with standard errors calculated for each value
pred <- predict(BasicM, newdata = LARApredict, type = "link", se.fit = TRUE)

# Add fit and SE generated by predict to LARApredict df
LARApredict$fit <- pred$fit
LARApredict$se <- pred$se.fit

# these were calculated on the log scale, which is how results are presented in logit, converting to probability scale (using plogis) for plotting both predicted values and 95% (1.96)confidence intervals
LARApredict$lower <- plogis(LARApredict$fit - 1.96 * LARApredict$se)
LARApredict$upper <- plogis(LARApredict$fit + 1.96 * LARApredict$se)
LARApredict$pred_prob <- plogis(LARApredict$fit)


LARApredplot<-ggplot(LARApredict, aes(x = Mass, y = pred_prob, color = Treatment, fill = Treatment)) +
  geom_line(linewidth =.5) +
  geom_ribbon(aes(ymin = lower, ymax = upper), alpha = 0.2, color = NA) +
  geom_point(data = LARA, aes(x = Mass, y = sprouted, color=Treatment), height = 0.03, alpha = 0.3, inherit.aes = FALSE) +
  labs(x = "Propagule mass", y = "Predicted probability of sprouting") +
  ggtitle(expression(italic("L. racesmosa")~"Predicted Sprouting Probability"))+
  theme(plot.title = element_text(hjust = 0.5),panel.background = element_rect(fill = "white", colour = "grey50"))+
  scale_fill_manual(name="Treatment",values=c("azure4","cornflowerblue","darkblue","salmon4"))+
  scale_color_manual(name="Treatment",values=c("azure4","cornflowerblue","darkblue","salmon4"))

LARApredplot


#combine both plots into a single figure

logitplot<-LARApredplot+AVGElogitplot
logitplot

ggsave(
  filename = "logitplot.jpg",  # output file name
  plot = logitplot,            # your ggplot object
  width = 3000,                      # width in pixels
  height = 1500,                     # height in pixels
  units = "px",                      # set units to pixels
  dpi = 300                          # resolution
)
```

Calculate days until sprouting visualize prop characterisics vs time until sprout to see if it looks like any prop characteristics have any effect on time until sprout!

```{r Calculate days until sprout and plot AVGE}

#now I'm going to remove the props that didnt sprout (leaves me with 529)
lubesprout<-sprout%>%filter(sprouted==1)

#subtracting sprout date from intake date to get duration until sprouting
lubesprout$DaysUntilSprout<-(lubesprout$SproutDate-lubesprout$IntakeDate)

#when it subtracts the two dates from each other it says X days, i want just the number so I am separating these two columns, with the space inbetween, so i have just a number in the days until sprout column
lubesprout<-lubesprout%>%separate(DaysUntilSprout, into = c("DaysUntilSprout","Day"), sep = " ")
#now it no longer knows what day is, so it changes it to an NA.

#one NA because no sproutdate
lubesprout <- lubesprout[!is.na(lubesprout$DaysUntilSprout), ]

#look at propagule things to see if any affect on duration to sprouting
#now plot the data with our factors to see if we thing there is a relationship 

lubesprout$DaysUntilSprout<-as.numeric(lubesprout$DaysUntilSprout)

#width
AWplot<-lubesprout%>%
  filter(Species=="AVGE")%>%
  ggplot(aes(y=DaysUntilSprout, x=`Width-mm`, color=Treatment))+
  geom_point()+
  ggtitle("AVGE")

AWplot

LWplot<-lubesprout%>%
  filter(Species=="LARA")%>%
  ggplot(aes(y=DaysUntilSprout, x=`Width-mm`, color=Treatment))+
  geom_point()+
  ggtitle("LARA")

LWplot

#prop mass
AMplot<-lubesprout%>%
   filter(Species=="AVGE")%>%
  ggplot(aes(x=Mass, y=DaysUntilSprout, color=Treatment))+
  geom_point()+
  ggtitle("AVGE")

AMplot


#lara mass
LMplot<-lubesprout%>%
   filter(Species=="LARA")%>%
  ggplot(aes(x=Mass, y=DaysUntilSprout, color=Treatment))+
  geom_point()+
  ggtitle("LARA")

LMplot


#prop length
ALplot<-lubesprout%>%
   filter(Species=="AVGE")%>%
  ggplot(aes(x=Mass, y=DaysUntilSprout, color=Treatment))+
  geom_point()+
  ggtitle("AVGE")

ALplot


LLplot<-lubesprout%>%
   filter(Species=="LARA")%>%
  ggplot(aes(x=Mass, y=DaysUntilSprout, color=Treatment))+
  geom_point()+
  ggtitle("LARA")

LLplot



lubesprout$`IntakeRadicleLength-cm`<-as.numeric(lubesprout$`IntakeRadicleLength-cm`)

#radicle lenght

Rplot<-lubesprout%>%
  filter(Species=="AVGE")%>%
  ggplot(aes(x=`IntakeRadicleLength-cm`, y=DaysUntilSprout, color=Treatment))+
  geom_point()

Rplot

```


Look at intake characteristics effect on days until sprouting, AVGE Table 5
```{r AVGE Poisson}
#lenght
ALplot<-lubesprout%>%
   filter(Species=="AVGE")%>%
  ggplot(aes(x=PropaguleLength, y=DaysUntilSprout, color=Treatment))+
  geom_point()+
  ggtitle("AVGE")

ALplot

#width
AWplot<-lubesprout%>%
  filter(Species=="AVGE")%>%
  ggplot(aes(y=DaysUntilSprout, x=`Width-mm`, color=Treatment))+
  geom_point()+
  ggtitle("AVGE")

AWplot
#mass
AMplot<-lubesprout%>%
   filter(Species=="AVGE")%>%
  ggplot(aes(x=Mass, y=DaysUntilSprout, color=Treatment))+
  geom_point()+
  ggtitle("AVGE")

AMplot
#intake rad length

Rplot<-lubesprout%>%
  filter(Species=="AVGE")%>%
  ggplot(aes(x=`IntakeRadicleLength-cm`, y=DaysUntilSprout, color=Treatment))+
  geom_point()

Rplot

#float
Fplot<-lubesprout%>%
  filter(Species=="AVGE")%>%
  ggplot(aes(x=Float, y=DaysUntilSprout, color=Treatment))+
  geom_jitter()+
  geom_point()

Fplot

#filger df for AVGE
AVGElube<-lubesprout%>%
  filter(Species=="AVGE")

AVGElube$Treatment<-as.factor(AVGElube$Treatment)

#first thing first no size things
Basicpoisson<-glm(DaysUntilSprout~Treatment+Float+SiteID, data=AVGElube, family="poisson")

summary(Basicpoisson)
#1446


#Length
Lpoisson<-glm(DaysUntilSprout~Treatment+Float+SiteID+PropaguleLength, data=AVGElube, family="poisson")

summary(Lpoisson)
#1441.3

#width
Wpoisson<-glm(DaysUntilSprout~Treatment+Float+SiteID+`Width-mm`, data=AVGElube, family="poisson")

summary(Wpoisson)
#1437.6

#mass
Mpoisson<-glm(DaysUntilSprout~Treatment+Float+SiteID+Mass, data=AVGElube, family="poisson")

summary(Mpoisson)
#Call:
#glm(formula = DaysUntilSprout ~ Treatment + Float + SiteID + 
#    Mass, family = "poisson", data = AVGElube)

#Coefficients:
#                       Estimate Std. Error z value Pr(>|z|)    
#(Intercept)             2.97785    0.09083  32.784  < 2e-16 ***
#TreatmentFresh         -0.72493    0.08454  -8.575  < 2e-16 ***
#TreatmentSalt          -0.10360    0.08098  -1.279 0.200808    
#TreatmentSoil          -0.46857    0.08302  -5.644 1.66e-08 ***
#FloatY                 -0.10586    0.04718  -2.244 0.024858 *  
#SiteIDSTEER Basin      -0.16832    0.05051  -3.332 0.000861 ***
#SiteIDVessup Salt Pond -0.08112    0.05336  -1.520 0.128489    
#Mass                   -0.15739    0.04153  -3.790 0.000151 ***
#---
#Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1

#(Dispersion parameter for poisson family taken to be 1)

#    Null deviance: 570.53  on 266  degrees of freedom
#Residual deviance: 350.79  on 259  degrees of freedom
#AIC: 1433.5

#Number of Fisher Scoring iterations: 4



```


effect on days until sprouting, LARA Table 7

```{r LARA Poisson}
#lenght
LLplot<-lubesprout%>% 
   filter(Species=="LARA")%>%
  ggplot(aes(x=PropaguleLength, y=DaysUntilSprout, color=Treatment))+
  geom_point()+
  ggtitle("LARA")

LLplot

#width
LWplot<-lubesprout%>%
  filter(Species=="LARA")%>%
  ggplot(aes(y=DaysUntilSprout, x=`Width-mm`, color=Treatment))+
  geom_point()+
  ggtitle("LARA")

LWplot
#mass
LMplot<-lubesprout%>%
   filter(Species=="LARA")%>%
  ggplot(aes(x=Mass, y=DaysUntilSprout, color=Treatment))+
  geom_point()+
  ggtitle("LARA")

LMplot



#filger df for LARA
LARAlube<-lubesprout%>%
  filter(Species=="LARA")

LARAlube$Treatment<-as.factor(LARAlube$Treatment)

#no size first
BasicLPoisson<-glm(DaysUntilSprout~Treatment+SiteID, data=LARAlube, family="poisson")
summary(BasicLPoisson)
#Call:
#glm(formula = DaysUntilSprout ~ Treatment + SiteID, family = "poisson", 
#    data = LARAlube)

#Coefficients:
#                       Estimate Std. Error z value Pr(>|z|)    
#(Intercept)             1.89447    0.09430  20.090  < 2e-16 ***
#TreatmentFresh         -0.83288    0.10946  -7.609 2.76e-14 ***
#TreatmentSalt          -0.34329    0.10073  -3.408 0.000655 ***
#TreatmentSoil           0.01049    0.09907   0.106 0.915702    
#SiteIDSTEER Basin      -0.35639    0.07560  -4.714 2.43e-06 ***
#SiteIDVessup Salt Pond -0.20705    0.07369  -2.810 0.004956 ** 
#---
#Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1

#(Dispersion parameter for poisson family taken to be 1)

#    Null deviance: 905.64  on 260  degrees of freedom
#Residual deviance: 770.21  on 255  degrees of freedom
#  (1 observation deleted due to missingness)
#AIC: 1536.5

#Number of Fisher Scoring iterations: 5
                       

exp(coef(BasicLPoisson))


#Mass
Lsproutpoisson<-glm(DaysUntilSprout~Treatment+Mass+SiteID, data=LARAlube, family="poisson")

summary(Lsproutpoisson)
#AIC 1538


Lsproutpoisson1<-glm(DaysUntilSprout~Treatment+PropaguleLength+SiteID, data=LARAlube, family="poisson")

summary(Lsproutpoisson1)
#AIC 1536

sproutpoisson2<-glm(DaysUntilSprout~Treatment+`Width-mm`+SiteID, data=LARAlube, family="poisson")

summary(sproutpoisson2)
#AIC 1538


```


Rerunning all combonations of AVGE poisson regressions

NEED TO READ INTO QQ PLOT THINGS
```{r}
#treatment only
Basic1<-glm(DaysUntilSprout~Treatment, data=AVGElube, family="poisson")
summary(Basic1)
#1473.2

#testing assumptions of bestfit model
qqnorm(residuals(Basic1, type = "pearson"))

#treatment&siteID
Basic<-glm(DaysUntilSprout~Treatment+SiteID, data=AVGElube, family="poisson")
summary(Basic)
#1455.2

#Treatment/Site/Length
TSL<-glm(DaysUntilSprout~Treatment+SiteID+PropaguleLength, data=AVGElube, family="poisson")
summary(TSL)
#1445.3

#Treatment/Site/Width
TSW<-glm(DaysUntilSprout~Treatment+SiteID+`Width-mm`, data=AVGElube, family="poisson")
summary(TSW)
#1442.6

#Treatment/Site/Mass
TSM<-glm(DaysUntilSprout~Treatment+SiteID+Mass, data=AVGElube, family="poisson")
summary(TSM)
#1436.6

#Treatment&Float
Basic3<-glm(DaysUntilSprout~Treatment+Float, data=AVGElube, family="poisson")
summary(Basic3)
#1462.6

#lenght
BasicL<-glm(DaysUntilSprout~Treatment+PropaguleLength, data=AVGElube, family="poisson")
summary(BasicL)
#1456.7

#width
BasicW<-glm(DaysUntilSprout~Treatment+`Width-mm`, data=AVGElube, family="poisson")
summary(BasicW)
#1452.7

#mass
BasicM<-glm(DaysUntilSprout~Treatment+Mass, data=AVGElube, family="poisson")
summary(BasicM)
#1446.3

#flaot length
NoSLengthLogit<-glm(DaysUntilSprout~Float+Treatment+PropaguleLength, data=AVGElube, family="poisson")
summary(NoSLengthLogit)
#1452.3


#float, width
NoSWidthLogit<-glm(DaysUntilSprout~Float+Treatment+`Width-mm`, data=AVGElube, family="poisson")
summary(NoSWidthLogit)
#1447.6

#flaotmass
NoSMassLogit<-glm(DaysUntilSprout~Float+Treatment+Mass, data=AVGElube, family="poisson")
summary(NoSMassLogit)
#1440.7

#site/float
BasicLogit<-glm(DaysUntilSprout~SiteID+Float+Treatment, data=AVGElube, family="poisson")
summary(BasicLogit)
#1446

#site/float/length

LengthLogit<-glm(DaysUntilSprout~SiteID+Float+Treatment+PropaguleLength, data=AVGElube, family="poisson")
summary(LengthLogit)
#1441.3

#site/Float/width
WidthLogit<-glm(DaysUntilSprout~SiteID+Float+Treatment+`Width-mm`, data=AVGElube, family="poisson")
summary(WidthLogit)
#1437.6

#site/Float/Mass BEST MODEL!!!
masslogit<-glm(DaysUntilSprout~SiteID+Float+Treatment+Mass, data=AVGElube, family="poisson")
summary(masslogit)
#1433.5

#Call:
#glm(formula = DaysUntilSprout ~ SiteID + Float + Treatment + 
#    Mass, family = "poisson", data = AVGElube)

#Coefficients:
#                       Estimate Std. Error z value Pr(>|z|)    
#(Intercept)             2.97785    0.09083  32.784  < 2e-16 ***
#SiteIDSTEER            -0.16832    0.05051  -3.332 0.000861 ***
#FloatY                 -0.10586    0.04718  -2.244 0.024858 *  
#TreatmentFresh         -0.72493    0.08454  -8.575  < 2e-16 ***
#TreatmentSalt          -0.10360    0.08098  -1.279 0.200808    
#TreatmentSoil          -0.46857    0.08302  -5.644 1.66e-08 ***
#Mass                   -0.15739    0.04153  -3.790 0.000151 ***
#---
#Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1

#(Dispersion parameter for poisson family taken to be 1)

#    Null deviance: 570.53  on 266  degrees of freedom
#Residual deviance: 350.79  on 259  degrees of freedom
#AIC: 1433.5

#Number of Fisher Scoring iterations: 4


```


rerunning all combinations of LARA poisson regression

```{r}
#treatment only
Basic1<-glm(DaysUntilSprout~Treatment, data=LARAlube, family="poisson")
summary(Basic1)
#1555.4



#treatment&siteID
Basic<-glm(DaysUntilSprout~Treatment+SiteID, data=LARAlube, family="poisson")
summary(Basic)
#1536.5

#Treatment/Site/Length
TSL<-glm(DaysUntilSprout~Treatment+SiteID+PropaguleLength, data=LARAlube, family="poisson")
summary(TSL)
#1536

#Treatment/Site/Width
TSW<-glm(DaysUntilSprout~Treatment+SiteID+`Width-mm`, data=LARAlube, family="poisson")
summary(TSW)
#1538.3

#Treatment/Site/Mass
TSM<-glm(DaysUntilSprout~Treatment+SiteID+Mass, data=LARAlube, family="poisson")
summary(TSM)
#1538.3

#Treatment&Float
Basic3<-glm(DaysUntilSprout~Treatment+Float, data=LARAlube, family="poisson")
summary(Basic3)
#1541.3

#lenght
BasicL<-glm(DaysUntilSprout~Treatment+PropaguleLength, data=LARAlube, family="poisson")
summary(BasicL)
#1541.9

#width
BasicW<-glm(DaysUntilSprout~Treatment+`Width-mm`, data=LARAlube, family="poisson")
summary(BasicW)
#1556.6

#mass
BasicM<-glm(DaysUntilSprout~Treatment+Mass, data=LARAlube, family="poisson")
summary(BasicM)
#1551.2

#flaot length
NoSLengthLogit<-glm(DaysUntilSprout~Float+Treatment+PropaguleLength, data=LARAlube, family="poisson")
summary(NoSLengthLogit)
#1529.2


#float, width
NoSWidthLogit<-glm(DaysUntilSprout~Float+Treatment+`Width-mm`, data=LARAlube, family="poisson")
summary(NoSWidthLogit)
#1542.2

#flaotmass
NoSMassLogit<-glm(DaysUntilSprout~Float+Treatment+Mass, data=LARAlube, family="poisson")
summary(NoSMassLogit)
#1537.6

#site/float
BasicLogit<-glm(DaysUntilSprout~SiteID+Float+Treatment, data=LARAlube, family="poisson")
summary(BasicLogit)
#1520.4


#Call:
#glm(formula = DaysUntilSprout ~ SiteID + Float + Treatment, family = "poisson", 
#    data = LARAlube)

#Coefficients:
#                       Estimate Std. Error z value Pr(>|z|)    
#(Intercept)             2.42048    0.19023  12.724  < 2e-16 ***
#SiteIDSTEER            -0.36029    0.07561  -4.765 1.89e-06 ***
#SiteIDVessup Salt Pond -0.26187    0.07573  -3.458 0.000544 ***
#FloatY                 -0.50807    0.16031  -3.169 0.001528 ** 
#TreatmentFresh         -0.84253    0.10955  -7.691 1.46e-14 ***
#TreatmentSalt          -0.36454    0.10115  -3.604 0.000313 ***
#TreatmentSoil          -0.02727    0.10012  -0.272 0.785381    
#---
#Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1

#(Dispersion parameter for poisson family taken to be 1)

#    Null deviance: 901.09  on 259  degrees of freedom
#Residual deviance: 756.25  on 253  degrees of freedom
#  (2 observations deleted due to missingness)
#AIC: 1520.4

#Number of Fisher Scoring iterations: 5



#site/float/length

LengthLogit<-glm(DaysUntilSprout~SiteID+Float+Treatment+PropaguleLength, data=LARAlube, family="poisson")
summary(LengthLogit)
#1520.9

#site/Float/width
WidthLogit<-glm(DaysUntilSprout~SiteID+Float+Treatment+`Width-mm`, data=LARAlube, family="poisson")
summary(WidthLogit)
#1522.4

#site/Float/Mass 
masslogit<-glm(DaysUntilSprout~SiteID+Float+Treatment+Mass, data=LARAlube, family="poisson")
summary(masslogit)
#1522.4

```


going to run a kaplin meyer curve analysis to analyze time until sprouting.. 
biostatssquid is a good source to walk through this analysis

The theory behind it all
https://biostatsquid.com/survival-time-analysis-easily-explained/
https://biostatsquid.com/kaplan-meier-curve/
https://biostatsquid.com/easy-log-rank-test/
https://biostatsquid.com/easy-cox-regression-for-survival-analysis/

the code (how to do it)
https://biostatsquid.com/easy-survival-analysis-r-tutorial/ 

another tutorial I like the first one better https://www.sthda.com/english/wiki/survival-analysis-basics

```{r Kaplin Meyer Survival Curve}
library(survival)
library(ggsurvfit)
library(survminer)
library(tidyverse)

#this is me stepping through the tutorial 
df <- survival::rotterdam

#censoring status: the values in this column are 1 = event happened, 0 = censored (or TRUE and FALSE). 

    #so in my case this would mean yes it sprouted, no it did not sprout


#time to event: from the start time (e.g., time of diagnosis) to the end time (the event happened or the last day of follow-up


df <- df %>% mutate(status = death)
table(df$status)
df <- df %>% mutate(dtime_yrs = dtime/365.25)
surv_obj <- Surv(time = df$dtime_yrs, event = df$status)


s1 <- survfit(surv_obj ~ 1, data = df)
summary(s1)

#plot 
km_curve <- ggsurvfit(s1, linewidth = 1) +
  labs(x = 'Years', y = 'Overall survival') +
  add_confidence_interval() +
  add_risktable() +
  scale_ggsurvfit() + 
  coord_cartesian(xlim = c(0, 8))

km_curve

s2 <- survfit(surv_obj ~ chemo, data = df)
ggsurvplot(s2, data = df,
           size = 1,
           palette = c('#E7B800', '#2e9fdf'),
           censor.shape = '|', censor.size = 4,
           conf.int = TRUE,
           pval = TRUE,
           risk.table = TRUE,
           risk.table.col = 'strata',
           legend.labs = list('0' = 'No chemo', '1' = 'Chemo'),
           risk.table.height = 0.25,
           ggtheme = theme_bw())

#log rank test
logrankres_chemo <- survdiff(Surv(dtime_yrs, status) ~ chemo, data = df)
logrankres_chemo

logrankres_hor <- survdiff(Surv(dtime_yrs, status) ~ hormon, data = df)
logrankres_hor


#cox test
cox_res <- coxph(Surv(dtime_yrs, status) ~ hormon + chemo + size + er + pgr + nodes + meno + grade + age, data = df)
cox_res
```

Running this with my data

```{r}



```



Cleaning data calculating proportion sprouted on each day for plotting, visualized in different ways
```{r Determine Percent Germinated}
library(lubridate)

#rename dataframe for manipulation
GermSprout<-sprout

#select for the columns I want to keep 
GermSprout<-GermSprout%>%
  select(Species, SiteID, Treatment, CollectionDate, IntakeDate, SproutDate, sprouted, `RadicleLenthAtPlant-cm`, Mass, PropaguleLength, `Width-mm`, Float)

#subtracting sprout date from intake date to get duration until sprouting
GermSprout$DaysUntilSprout<-(GermSprout$SproutDate-GermSprout$IntakeDate)

#replacing nas with zeros, zeros mean that the seeds never sprouted
GermSprout$DaysUntilSprout[is.na(GermSprout$DaysUntilSprout)] <- 0

#add a column named Day that is all 1s, so I can sum the number 
GermSprout<-GermSprout%>%mutate(Day=1)

#grouping by species treatment and site ID, and days until sprout, then summing together all the 1s in the day column so I can see how many sprouted on each of the days until sprouting
GermSproutCount<-GermSprout%>%
  group_by(Species, Treatment, SiteID,DaysUntilSprout)%>%
  summarise(sum(Day))

#change the class of the resulting object and columns
GermSproutCount<-as.data.frame(GermSproutCount)


#pivoting wider, have the days across the top and the number sprouted that day as values
GermSproutCount<-GermSproutCount%>%
  pivot_wider(names_from =DaysUntilSprout, values_from=`sum(Day)`)

#filling in blanks with zeros
GermSproutCount[is.na(GermSproutCount)]<-0

#rename columns instead of #s, when they are numbers It will not let me call them 
colnames(GermSproutCount)[4]<-"DidNotSprout"
colnames(GermSproutCount)[5]<-"Day_8"
colnames(GermSproutCount)[6]<-"Day_11"
colnames(GermSproutCount)[7]<-"Day_16"
colnames(GermSproutCount)[8]<-"Day_21"
colnames(GermSproutCount)[9]<-"Day_4"
colnames(GermSproutCount)[10]<-"Day_12"
colnames(GermSproutCount)[11]<-"Day_13"
colnames(GermSproutCount)[12]<-"Day_28"
colnames(GermSproutCount)[13]<-"Day_5"
colnames(GermSproutCount)[14]<-"Day_6"
colnames(GermSproutCount)[15]<-"Day_7"
colnames(GermSproutCount)[16]<-"Day_9"
colnames(GermSproutCount)[17]<-"Day_10"
colnames(GermSproutCount)[18]<-"Day_2"
colnames(GermSproutCount)[19]<-"Day_3"
colnames(GermSproutCount)[20]<-"Day_14"
colnames(GermSproutCount)[21]<-"Day_15"
colnames(GermSproutCount)[22]<-"Day_17"
colnames(GermSproutCount)[23]<-"Day_18"
colnames(GermSproutCount)[24]<-"Day_20"
colnames(GermSproutCount)[25]<-"Day_19"
colnames(GermSproutCount)[26]<-"Day_24"
colnames(GermSproutCount)[27]<-"Day_1"

#Organizing the columns in order
GermSproutCount<-GermSproutCount[c("Species","Treatment","SiteID","DidNotSprout","Day_1","Day_2","Day_3","Day_4","Day_5","Day_6","Day_7","Day_8","Day_9","Day_10","Day_11","Day_12","Day_13","Day_14","Day_15","Day_16","Day_17","Day_18","Day_19","Day_20","Day_21","Day_24","Day_28")]

#get the sum of all the columns and figure out the proportion sprouted
GermSproutCount<-GermSproutCount%>%
  mutate(TotalSprouted=(Day_1+Day_2+Day_3+Day_4+Day_5+Day_6+Day_7+Day_8+Day_9+Day_10+Day_11+Day_12+Day_13+Day_14+Day_15+Day_16+Day_17+Day_18+Day_19+Day_20+Day_21+Day_24+Day_28))

#sum not sprouted and sprouted to get the total number of props per treatment
GermSproutCount<-GermSproutCount%>%
  mutate(TotalProps=TotalSprouted+DidNotSprout)


#rename the dataframe so I can rewrite over the values in the columns, and after double check things to make sure worked correctly
PropGermSproutCount<-GermSproutCount


#this is looping through columns 4:27 (Day 1:Day 28) and adding so we know the cumulative sum of props that had sprouted on each day (if the column is column 4, we just want column four, because that is day one and there are no previous days, if it is any column after, through column 27 we want to add the value to the one before it)
for(i in 1:nrow(PropGermSproutCount)){
  for(j in 5:27){
    if(j == 5){
      PropGermSproutCount[i,j] <- PropGermSproutCount[i,j]
    }
    else{
      PropGermSproutCount[i,j] <- (PropGermSproutCount[i,j]+PropGermSproutCount[i,j-1])
    }
  }
}

#rename the dataframe again 
DPropGermSproutCount<-PropGermSproutCount 

#now i am taking each column and dividing it by the total number of props present
for(i in 5:27){
  DPropGermSproutCount[,i]<-DPropGermSproutCount[,i]/DPropGermSproutCount[,29]
}

#now I am plotting the proportion of props that sprouted on each day, separated by treatment for each species


#first fitlering for species and site, then pivoting longer so I can plot
AVGEpropplotDF<-DPropGermSproutCount%>%
  filter(Species=="AVGE")%>%
  filter(SiteID=="Compass Point")%>%
  pivot_longer(cols=!c(Species,Treatment, SiteID, DidNotSprout, TotalSprouted, TotalProps), names_to="Day", values_to="ProportionSprouted")


#now we need to separate out the column names back into day and number so  r will recognize them as numbers and plot them in order
AVGEpropplotDF<-AVGEpropplotDF%>%separate(`Day`, into = c("Day","DayNumber"), sep = "_")

AVGEpropplotDF$`DayNumber`<-as.numeric(AVGEpropplotDF$`DayNumber`)


#making the plot
AVGEpropplot<-AVGEpropplotDF%>%
  ggplot(aes(x=DayNumber, y=ProportionSprouted, color=Treatment))+
  geom_line()+
  geom_point()+
  xlab("Number of Days After Intake")+
  ylab("Proportion of Propagules Sprouted")+
  ggtitle("AVGE Collected From Compass Point")+
  scale_color_manual(name="Treatment",values=c("azure4","cornflowerblue","darkblue","salmon4"))+
  theme(plot.title = element_text(hjust = 0.5), panel.background = element_rect(fill = "white", colour = "grey50"))


AVGEpropplot
```

Making figure 8

```{r Functionify the plotmaking}
library(patchwork)#for stitching plots together

#rearragning the code above so i can put it into a function, first fitlering for species and site, then pivoting longer so I can plot

LongFrame<-DPropGermSproutCount%>%
  pivot_longer(cols=!c(Species,Treatment, SiteID, DidNotSprout, TotalSprouted, TotalProps), names_to="Day", values_to="ProportionSprouted")%>%
  separate(`Day`, into = c("Day","DayNumber"), sep = "_")%>%
  mutate(DayNumber=as.numeric(DayNumber))%>%
  filter(Species=="AVGE"&SiteID=="Compass Point")%>%
   ggplot(aes(x=DayNumber, y=ProportionSprouted, color=Treatment))+
  geom_line()+
  geom_point()+
  xlab("Number of Days After Intake")+
  ylab("Proportion of Propagules Sprouted")+
  ggtitle("AVGE Collected From Compass Point")+
  scale_color_manual(name="Treatment",values=c("olivedrab","cornflowerblue","darkblue","salmon4"))+
  theme(plot.title = element_text(hjust = 0.5), panel.background = element_rect(fill = "white", colour = "grey50"))
  
LongFrame

#make my titles as objects so they can have sci name italisized
LV<-expression(italic("L. racemosa")~"Seeds Collected From Vessup Salt Pond")
AV<-expression(italic("A. germinans")~"Propagules Collected From Vessup Salt Pond")
LC<-expression(italic("L. racemosa")~"Seeds Collected From Compass Point")
AC<-expression(italic("A. germinans")~"Propagules Collected From Compass Point")
LS<-expression(italic("L. racemosa")~"Seeds Collected From STEER")
AS<-expression(italic("A. germinans")~"Propagules Collected From STEER")

#modifying treatment labels
treatment_labels <- c(
  "Air" = "No Substrate",
  "Fresh" = "Freshwater",
  "Salt" = "Saltwater",
  "Soil" = "Soil"
)


#now turning my plot and code into a function, that plots my data 
PropPlot<-function(data, species_value, siteid_value,title){data%>%
  pivot_longer(cols=!c(Species,Treatment, SiteID, DidNotSprout, TotalSprouted, TotalProps), 
               names_to="Day", 
               values_to="ProportionSprouted")%>%
  separate(Day, into = c("Day","DayNumber"), sep = "_")%>%
  mutate(DayNumber=as.numeric(DayNumber))%>%
  filter(Species==species_value & SiteID==siteid_value)%>%
   ggplot(aes(x= DayNumber, y= ProportionSprouted, color= Treatment))+
  geom_line()+
  geom_point()+
  xlab("Number of Days After Intake")+
  ylab("Proportion Sprouted")+
  ggtitle(title)+
  scale_color_manual(name="Treatment",values=c("olivedrab","cornflowerblue","darkblue","salmon4"), labels=treatment_labels)+
  theme(plot.margin = margin(10, 10, 10, 10),plot.title = element_text(hjust = 0.5), panel.background = element_rect(fill = "white", colour = "grey50"))}

#plotting each combo of species and site

#Compass Point AVGE  
CompassAVGEprop<-PropPlot(DPropGermSproutCount,"AVGE", "Compass Point",AC)

CompassAVGEprop

#Compass Point LARA
CompassLARAprop<-PropPlot(DPropGermSproutCount,"LARA", "Compass Point",LC)

CompassLARAprop

#STEER basin AVGE  
SteerAVGEprop<-PropPlot(DPropGermSproutCount,"AVGE", "STEER Basin", AS)

SteerAVGEprop

#STEER basin LARA
SteerLARAprop<-PropPlot(DPropGermSproutCount,"LARA", "STEER Basin", LS)

SteerLARAprop

#Vessup  AVGE  
VessupAVGEprop<-PropPlot(DPropGermSproutCount,"AVGE", "Vessup Salt Pond", AV)

VessupAVGEprop

#Vessup LARA
VessupLARAprop<-PropPlot(DPropGermSproutCount,"LARA", "Vessup Salt Pond",LV)

VessupLARAprop


#patch the plots together and collect all the legends into one
PPatchPlot<-VessupLARAprop+CompassLARAprop+SteerLARAprop+VessupAVGEprop+CompassAVGEprop+SteerAVGEprop+plot_layout(guides = 'collect')

PPatchPlot

#patch vertically 

p1<-VessupLARAprop+VessupAVGEprop+plot_layout(guides = 'collect')
p1
p2<-CompassLARAprop+CompassAVGEprop+plot_layout(guides = 'collect')
p3<-SteerLARAprop+SteerAVGEprop+plot_layout(guides = 'collect')

VPatch<-p1/p2/p3+plot_layout(guides = 'collect')
VPatch

```


look at all the props together not including site Making figure 6

```{r}

#grouping by species treatment and site ID, and days until sprout, then summing together all the 1s in the day column so I can see how many sprouted on each of the days until sprouting
TreatPlot<-GermSprout%>%
  group_by(Species,Treatment,DaysUntilSprout)%>%
  summarise(sum(Day))

#change the class of the resulting object and columns
TreatPlot<-as.data.frame(TreatPlot)


#pivoting wider, have the days across the top and the number sprouted that day as values
TreatPlot<-TreatPlot%>%
  pivot_wider(names_from =DaysUntilSprout, values_from=`sum(Day)`)

#filling in blanks with zeros
TreatPlot[is.na(TreatPlot)]<-0

#rename columns instead of #s, when they are numbers It will not let me call them 
colnames(TreatPlot)[3]<-"DidNotSprout"
colnames(TreatPlot)[4]<-"Day_4"
colnames(TreatPlot)[5]<-"Day_8"
colnames(TreatPlot)[6]<-"Day_11"
colnames(TreatPlot)[7]<-"Day_12"
colnames(TreatPlot)[8]<-"Day_13"
colnames(TreatPlot)[9]<-"Day_16"
colnames(TreatPlot)[10]<-"Day_21"
colnames(TreatPlot)[11]<-"Day_28"
colnames(TreatPlot)[12]<-"Day_2"
colnames(TreatPlot)[13]<-"Day_3"
colnames(TreatPlot)[14]<-"Day_5"
colnames(TreatPlot)[15]<-"Day_6"
colnames(TreatPlot)[16]<-"Day_7"
colnames(TreatPlot)[17]<-"Day_9"
colnames(TreatPlot)[18]<-"Day_10"
colnames(TreatPlot)[19]<-"Day_14"
colnames(TreatPlot)[20]<-"Day_15"
colnames(TreatPlot)[21]<-"Day_17"
colnames(TreatPlot)[22]<-"Day_18"
colnames(TreatPlot)[23]<-"Day_20"
colnames(TreatPlot)[24]<-"Day_19"
colnames(TreatPlot)[25]<-"Day_24"
colnames(TreatPlot)[26]<-"Day_1"


#Organizing the columns in order
TreatPlot<-TreatPlot[c("Species","Treatment","DidNotSprout","Day_1","Day_2","Day_3","Day_4","Day_5","Day_6","Day_7","Day_8","Day_9","Day_10","Day_11","Day_12","Day_13","Day_14","Day_15","Day_16","Day_17","Day_18","Day_19","Day_20","Day_21","Day_24","Day_28")]

#get the sum of all the columns and figure out the proportion sprouted
TreatPlot<-TreatPlot%>%
  mutate(TotalSprouted=(Day_1+Day_2+Day_3+Day_4+Day_5+Day_6+Day_7+Day_8+Day_9+Day_10+Day_11+Day_12+Day_13+Day_14+Day_15+Day_16+Day_17+Day_18+Day_19+Day_20+Day_21+Day_24+Day_28))

#sum not sprouted and sprouted to get the total number of props per treatment
TreatPlot<-TreatPlot%>%
  mutate(TotalProps=TotalSprouted+DidNotSprout)


#rename the dataframe so I can rewrite over the values in the columns, and after double check things to make sure worked correctly
TreatPlot1<-TreatPlot


#this is looping through columns 4:27 (Day 1:Day 28) and adding so we know the cumulative sum of props that had sprouted on each day (if the column is column 4, we just want column four, because that is day one and there are no previous days, if it is any column after, through column 27 we want to add the value to the one before it)
for(i in 1:nrow(TreatPlot1)){
  for(j in 4:26){
    if(j == 4){
      TreatPlot1[i,j] <- TreatPlot1[i,j]
    }
    else{
      TreatPlot1[i,j] <- (TreatPlot1[i,j]+TreatPlot1[i,j-1])
    }
  }
}


#now i am taking each column and dividing it by the total number of props present
for(i in 4:26){
  TreatPlot1[,i]<-TreatPlot1[,i]/TreatPlot1[,28]
}


#first filtering for species and site, then pivoting longer so I can plot
AVGEpropplotDF<-TreatPlot1%>%
  filter(Species=="AVGE")%>%
  pivot_longer(cols=!c(Species,Treatment, DidNotSprout, TotalSprouted, TotalProps), names_to="Day", values_to="ProportionSprouted")



#now we need to separate out the column names back into day and number so  r will recognize them as numbers and plot them in order
AVGEpropplotDF<-AVGEpropplotDF%>%separate(`Day`, into = c("Day","DayNumber"), sep = "_")

AVGEpropplotDF$`DayNumber`<-as.numeric(AVGEpropplotDF$`DayNumber`)


#making the plot
AVGEpropplot<-AVGEpropplotDF%>%
  ggplot(aes(x=DayNumber, y=ProportionSprouted, color=Treatment))+
  geom_line()+
  geom_point()+
  xlab("Number of Days After Intake")+
  ylab("Proportion of Propagules Sprouted")+
  ggtitle(expression("Proportion of" ~italic("A. germinans")~"Propagules Sprouted"))+
  scale_color_manual(name="Treatment",values=c("azure4","cornflowerblue","darkblue","salmon4"), labels=treatment_labels)+
  theme(plot.title = element_text(hjust = 0.5), panel.background = element_rect(fill = "white", colour = "grey50"))


AVGEpropplot

#and now we do LARA


#first filtering for species and site, then pivoting longer so I can plot
LARApropplotDF<-TreatPlot1%>%
  filter(Species=="LARA")%>%
  pivot_longer(cols=!c(Species,Treatment, DidNotSprout, TotalSprouted, TotalProps), names_to="Day", values_to="ProportionSprouted")


#now we need to separate out the column names back into day and number so  r will recognize them as numbers and plot them in order
LARApropplotDF<-LARApropplotDF%>%separate(`Day`, into = c("Day","DayNumber"), sep = "_")

LARApropplotDF$`DayNumber`<-as.numeric(LARApropplotDF$`DayNumber`)


#making the plot
LARApropplot<-LARApropplotDF%>%
  ggplot(aes(x=DayNumber, y=ProportionSprouted, color=Treatment))+
  geom_line()+
  geom_point()+
  xlab("Number of Days After Intake")+
  ylab("Proportion of Seeds Sprouted")+
   ggtitle(expression("Proportion of" ~italic("L. racemosa")~"Seeds Sprouted"))+
  scale_color_manual(name="Treatment",values=c("azure4","cornflowerblue","darkblue","salmon4"), labels=treatment_labels)+
  theme(plot.title = element_text(hjust = 0.5), panel.background = element_rect(fill = "white", colour = "grey50"))


LARApropplot

totalpatchplot<-LARApropplot+AVGEpropplot+plot_layout(guides = 'collect')
totalpatchplot

```


This is running a KW test for LARA with the ones that didnt sprout removed plotting results for LARA
```{r FINAL KW choice LARA}
#2) KW no sprout removed

TLARA<-GermSprout%>%
  filter(Species=="LARA")%>%
  select(SiteID, Treatment, DaysUntilSprout)

TLARA$DaysUntilSprout<-as.numeric(TLARA$DaysUntilSprout)

#filter to remove props that did not sprout
LARAR<-TLARA%>%
  filter(DaysUntilSprout!=0)

SproutLARAViolinPlot<-LARAR%>%
  ggplot(aes(x=Treatment, y=DaysUntilSprout, color=Treatment))+#setting my x and y values, 
  geom_violin()+#
    geom_sina()+#adds all the dots to the violin plot needs ggforce library
    geom_boxplot(width=0.1, color="black", alpha=0.2)+
  ggtitle(expression(italic("L. racemosa") ~ "Treatment Effect on Days Until Sprouting"))+
  ylab("Days Until Sprout")+
  xlab("Treatment")+
  theme(legend.position = "none", plot.title = element_text(hjust = 0.5), panel.background = element_rect(fill = "white", colour = "grey50"))+#no legend, centered title, no background
   scale_x_discrete(labels = c(
  "Air" = "No Substrate",
  "Fresh" = "Freshwater",
  "Salt" = "Saltwater",
  "Soil" = "Soil"
))+
    scale_color_manual(name = "Treatment", values = c("olivedrab","cornflowerblue","darkblue","salmon4"))+#sets the colors manually of the dots, and outlines of violin plots
    geom_text(aes(family="serif", fontface="plain"),x= "Air" , y=30, label="ab", colour="black")+#add first letter, family and fontface change font and remove bold
  geom_text(aes(family="serif", fontface="plain"),x= "Fresh" , y=30, label="a", colour="black")+#add second letter
  geom_text(aes(family="serif", fontface="plain"), x= "Salt" , y=30, label="b", colour="black")+#third letter 
  geom_text(aes(family="serif", fontface="plain"), x= "Soil" , y=30, label="b", colour="black")+
  ylim(0,30)

SproutLARAViolinPlot

bartlett.test(DaysUntilSprout~Treatment, LARAR)

kruskal.test(DaysUntilSprout~Treatment, LARAR)

#	Kruskal-Wallis rank sum test

#data:  DaysUntilSprout by Treatment
#Kruskal-Wallis chi-squared = 25.094, df = 3, p-value = 1.475e-05

LARADunn=dunnTest(DaysUntilSprout ~ Treatment,
  data = LARAR)

LARADunn

#         Comparison         Z      P.unadj        P.adj
#1  Air - Fresh  1.313372 1.890575e-01 3.781150e-01
#2   Air - Salt -1.021697 3.069241e-01 3.069241e-01
#3 Fresh - Salt -3.403578 6.650954e-04 3.325477e-03
#4   Air - Soil -2.130880 3.309900e-02 1.323960e-01
#5 Fresh - Soil -4.801471 1.575043e-06 9.450260e-06
#6  Salt - Soil -1.605593 1.083633e-01 3.250899e-01

Lab1 = LARADunn$res

cldList(comparison = Lab1$Comparison,
        p.value    = Lab1$P.adj,
        threshold  = 0.05)

#  Group Letter MonoLetter
#1   Air     ab         ab
#2 Fresh      a         a 
#3  Salt      b          b
#4  Soil      b          b
```

This is running KW with the ones that didnt sprout removed for AVGE, and plotting results, combined two plots and create figure 7

```{r FINAL KW choice AVGE}
#2) KW no sprout removed

TAVGE<-GermSprout%>%
  filter(Species=="AVGE")%>%
  select(SiteID, Treatment, DaysUntilSprout)

TAVGE$DaysUntilSprout<-as.numeric(TAVGE$DaysUntilSprout)

#filter to remove props that did not sprout
AVGER<-TAVGE%>%
  filter(DaysUntilSprout!=0)

SproutAVGEViolinPlot<-AVGER%>%
  ggplot(aes(x=Treatment, y=DaysUntilSprout, color=Treatment))+#setting my x and y values, 
  geom_violin()+#
    geom_sina()+#adds all the dots to the violin plot needs ggforce library
    geom_boxplot(width=0.1, color="black", alpha=0.2)+
 ggtitle(expression(italic("A. germinans") ~ "Treatment Effect on Days Until Sprouting"))+
  ylab("Days Until Sprout")+
  xlab("Treatment")+
  theme(legend.position = "none", plot.title = element_text(hjust = 0.5), panel.background = element_rect(fill = "white", colour = "grey50"))+#no legend, centered title, no background
    scale_color_manual(name = "Treatment", values = c("olivedrab","cornflowerblue","darkblue","salmon4"))+#sets the colors manually of the dots, and outlines of violin plots
 scale_x_discrete(labels = c(
  "Air" = "No Substrate",
  "Fresh" = "Freshwater",
  "Salt" = "Saltwater",
  "Soil" = "Soil"
))+
    geom_text(aes(family="serif", fontface="plain"),x= "Air" , y=30, label="a", colour="black")+#add first letter, family and fontface change font and remove bold
  geom_text(aes(family="serif", fontface="plain"),x= "Fresh" , y=30, label="b", colour="black")+#add second letter
  geom_text(aes(family="serif", fontface="plain"), x= "Salt" , y=30, label="a", colour="black")+#third letter 
  geom_text(aes(family="serif", fontface="plain"), x= "Soil" , y=30, label="c", colour="black")+
  ylim(0,30)

SproutAVGEViolinPlot

bartlett.test(DaysUntilSprout~Treatment, AVGER)

kruskal.test(DaysUntilSprout~Treatment, AVGER)

#Kruskal-Wallis rank sum test

#data:  DaysUntilSprout by Treatment
#Kruskal-Wallis chi-squared = 91.09, df = 3, p-value < 2.2e-16

AVGEDunn=dunnTest(DaysUntilSprout ~ Treatment,
  data = AVGER)

AVGEDunn

#      Comparison          Z      P.unadj        P.adj
#1  Air - Fresh  5.0556550 4.289160e-07 1.715664e-06
#2   Air - Salt  0.3751177 7.075729e-01 7.075729e-01
#3 Fresh - Salt -8.9334001 4.131124e-19 2.478674e-18
#4   Air - Soil  3.3442384 8.250881e-04 2.475264e-03
#5 Fresh - Soil -3.0955342 1.964587e-03 3.929174e-03
#6  Salt - Soil  5.5349502 3.113168e-08 1.556584e-07

Lab1 = AVGEDunn$res

cldList(comparison = Lab1$Comparison,
        p.value    = Lab1$P.adj,
        threshold  = 0.05)

#  Group Letter MonoLetter
#1   Air     a         a
#2 Fresh      b         b
#3  Salt      a          a
#4  Soil      c          c



TreatmentTimePlot<-SproutLARAViolinPlot+SproutAVGEViolinPlot
TreatmentTimePlot

```
